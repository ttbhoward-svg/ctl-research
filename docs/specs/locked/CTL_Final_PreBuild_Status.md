# CTL Research Infrastructure — Final Pre-Build Status
## Feb 17, 2026 — For Gemini Review + Build Handoff

---

# PROJECT OVERVIEW

**What:** A one-person systematic trading research infrastructure that quantifies the edge in a discretionary futures/equities methodology (CTL / "C The Light" by Dean Karrys). The system scores trade setups using Elastic Net regression on pre-registered features, validated via purged time-series cross-validation with strict phase-gate governance.

**Who:** Tim, 39, managing $550K personal capital. 6 years following CTL methodology. No coding experience — all code generated by AI agents (Claude Code for build, Claude for research/PM, Codex for methodology review, Gemini for statistical review).

**Why:** Agency over trading decisions. The gap between Tim's IRA (100%+ returns, no scalping possible) and brokerage (50%+ returns, discipline failures) proves the edge exists but execution discipline degrades without structural constraints. This system provides the scoring framework, risk guardrails, and psychological scaffolding to scale from $550K toward generational wealth.

**Goal:** Quantify which confluence factors genuinely improve trade outcomes. Score live setups in real time. Force systematic risk management. Enable confident scaling to $5M+ without the emotional deterioration that destroys discretionary traders who scale without a framework.

---

# DOCUMENT MANIFEST (Complete Spec Stack)

| # | Document | Version | Status |
|---|----------|---------|--------|
| 1 | B1 Strategy Logic Spec | v2 | **Locked** |
| 2 | Phase 1a Project Tracker | v3 | **Locked** |
| 3 | Phase Gate Checklist | v2 | **Locked** (Gemini research-column rule added) |
| 4 | Research Infrastructure Synthesis | v2 | **Locked** |
| 5 | Pre-Build Lock (symbols, gates, pre-registration) | v1 | **Locked** |
| 6 | Pre-Build Lock Addendum 1 (calibration, meta-label, drift) | v1 | **Locked** |
| 7 | Codex Universe Lock Spec | v1 | **Locked** |
| 8 | Codex Dashboard Build Spec | v1.1 | **Locked** (Phase 2+ reference) |
| 9 | Phase 2 Pre-Registration Additions | v1 | Parked (not active until Gate 1 passes) |
| 10 | Sandbox Appendix | v1 | Living document |
| 11 | Spec Additions Batch 2 (risk infrastructure) | v1 | Parked (Phase 2-3) |
| 12 | Macro Trader Research Handoff | v1 | Reference only |
| 13 | **Gemini Final Review** | **v1** | **PASSED — no structural objections** |
| 14 | **Gemini AI Instruction Brief** | **v1** | **Use at start of every Claude Code session** |
| 15 | **This Document** | **v1** | **Final pre-build status** |

---

# B1 STRATEGY DECISIONS (All Resolved)

## Spec Changes Required Before Build

### Change 1: Breakdown Buffer → ATR-Based (DP-2)

**Old (Section 2, Condition 3):**
```
Close[N] > EMA10[N] * (1 - 0.02)
```

**New:**
```
Close[N] > EMA10[N] - (ATR14[N] * 0.5)

Parameter: BreakdownBuffer_ATR = 0.5
Pre-registered sweep: 0.3 - 0.7
Stability test: must work at 0.4 and 0.6
```

Rationale: Fixed 2% is not self-calibrating across a mixed universe of futures ($1,200 /PA vs $5,000 /ES) and equities ($90 $MU vs $500 $XOM). ATR-based buffer automatically adjusts to each instrument's volatility regime.

### Change 2: Add Research Columns to Output Schema

Add these columns to Section 10 (logged but NOT used as regression features in Phase 1a):

```
# Touch depth (DP-1)
touch_depth_atr         # float: (EMA10[N] - Low[N]) / ATR14[N]. 0 = exact touch, higher = deeper.

# Drag-up flag (DP-1 extension)
is_drag_up              # boolean: TRUE if this trigger's qualifying touch was from a bar
                        # that did NOT qualify when it originally printed (EMA caught up later)

# Alternative entry prices (DP-3)
entry_price_n1          # float: Open of bar N+1 (for comparison with N+2 entry)

# Alternative swing highs for fib targets (DP-4)
swing_high_recent       # float: most recent local swing high (not necessarily absolute highest)
swing_high_short        # float: highest high in last 10 bars (shorter lookback)
tp1_recent, tp2_recent, tp3_recent  # fib targets from recent swing high
tp1_short, tp2_short, tp3_short     # fib targets from short lookback swing high

# Alternative stop levels (DP-5)
stop_atr                # float: EntryPrice - (ATR14[N] * 1.5)
stop_swing_low          # float: Lowest(Low, 5) looking back from trigger bar

# Multi-TF partial entry research (DP-3 extension)
weekly_trigger_daily_confirmation  # boolean: for weekly triggers only — did a daily close
                                   # above weekly EMA10 occur within 5 bars of trigger?
wide_stop_flag          # boolean: TRUE if stop distance > 2x ATR14 on trigger timeframe

# H4 structural context (logged at trigger time from instrument's native H4 bars)
h4_above_200sma         # boolean: H4 close > H4 SMA(200) at trigger time
h4_200sma_distance_atr  # float: (H4 close - H4 SMA200) / ATR14. Positive = above, negative = below.
h4_trend_aligned        # boolean: H4 close > H4 EMA10 AND H4 slope positive
# Note: Futures H4 anchored to top of hour, equities/ETFs anchored to 9:30 AM open.
# Each instrument uses its own H4 context — no cross-asset H4 alignment.
# SBSW: H4 columns NULL (no reliable intraday data from yfinance).

# Fib retracement nest (EMA sitting near 61.8/78.6 of the up-move that created bars-of-air)
pullback_fib_618_level  # float: 61.8% retracement of swing_low_launch → SwingHigh
pullback_fib_786_level  # float: 78.6% retracement of swing_low_launch → SwingHigh
ema_fib_proximity_atr   # float: min distance from EMA10 to either fib level, in ATR units
fib_retracement_nest    # boolean: TRUE if ema_fib_proximity_atr < 0.5 (pre-registered, test as we go)
# swing_low_launch = Lowest(Low, 12) around bar where air sequence began
```

### Change 3: Timeframe-Specific Swing Lookback (DP-4)

**Old (Section 5.1):**
```
SwingLookback = 20  (all timeframes)
```

**New:**
```
SwingLookback_daily = 20
SwingLookback_weekly = 12

Parameter sweep: daily 15-25, weekly 8-16
Stability test: daily must work at 18 and 22, weekly must work at 10 and 14
```

Rationale: 20 weekly bars = 5 months. 12 weekly bars = 3 months. More appropriate swing reference for weekly setups. The alternative swing high research columns (above) will inform whether even shorter lookbacks perform better.

## Decisions Locked (No Spec Change Required)

| DP | Decision | Spec Impact |
|----|----------|-------------|
| DP-1 | Binary trigger, log touch depth gradient | Research column added, trigger rule unchanged |
| DP-3 | Keep N+2 entry, log N+1 for comparison | Research column added, entry rule unchanged |
| DP-5 | Keep trigger bar low stop, log alternatives | Research columns added, stop rule unchanged |

## New Concepts Captured

### Drag-Up (logged, not gated)
A trigger where the qualifying EMA touch came from a bar that was NOT touching the EMA when it printed — the rising EMA subsequently caught up to the bar's low. Logged as `is_drag_up = TRUE`. Phase 1a regression will reveal if drag-ups perform differently from fresh touches.

### Multi-TF Partial Entry (Sandbox Item 6)
On weekly triggers with wide stops (>2x ATR), enter in thirds across lower timeframes (H4/daily/weekly close confirmations). Cannot be backtested in Phase 1a (no H4 data). Logged as research flags for Phase 2 investigation. Added to Sandbox Appendix.

### H4 Structural Context (logged, not gated)
H4 data acquired for all 28 tradable symbols. At each daily/weekly trigger, log H4 200 SMA relationship and H4 EMA10 trend alignment. Captures structural headwinds (price stuck under H4 200 SMA) that inform whether to take the higher-TF trade. Futures H4 bars anchor to top of hour; equities/ETFs anchor to 9:30 AM market open per CTL convention. H4 context is self-referential per instrument — never cross-asset compared.

### Fib Retracement Nest (logged, not gated)
When price pulls back to the 10 EMA, check whether the EMA sits near the 61.8% or 78.6% retracement of the up-move that created the bars-of-air. "Near" = within 0.5 ATR (pre-registered, to be validated). The swing low for this calculation is the lowest low in ~12 bars around where the air sequence began. A fib-EMA nest means the pullback has structural support — the EMA and a fib retracement level are reinforcing each other. Logged as both continuous (distance in ATR units) and boolean (nest present Y/N). If regression or chart study shows clear value, promote to Phase 2 feature candidate.

---

# UNIVERSE (Locked)

## Phase 1a: 29 Symbols (28 Tradable + 1 Research Only)

| Cluster | Symbols | Count |
|---------|---------|-------|
| IDX_FUT | /ES, /NQ, /YM, /RTY | 4 |
| METALS_FUT | /PA, /GC, /SI, /HG, /PL | 5 |
| ENERGY_FUT | /CL, /NG | 2 |
| RATES_FUT | /ZB, /ZN | 2 |
| GRAINS_FUT | /ZC, /ZS | 2 |
| ETF_SECTOR | XLE, XME, GDX, XLF, XLI, XLK, XLY | 7 |
| EQ_COMMODITY_LINKED | $XOM, $FCX, $NEM, $CAT (tradable), $SBSW (research_only) | 5 |
| EQ_MACRO_BELLWETHER | $GS, $MU | 2 |
| **Total** | | **29** |

Expected triggers: ~840-1110 (daily + weekly, 7 years)

## Core + Satellite Governance
- `tradable` = can generate live trades from model scores
- `research_only` = informs regression coefficients, cannot generate live trades
- Promotion/demotion via formal gate with logged reason code
- Universe lock file committed before build. No changes without gate decision.
- 11-cluster taxonomy. Immutable within phase.

---

# GATE 1 CRITERIA (9 Required)

| # | Criterion | Threshold |
|---|-----------|-----------|
| 1 | OOS trade count | ≥ 30 |
| 2 | OOS tercile spread | ≥ +1.0R (top minus bottom) |
| 3 | Score monotonicity | Top > Mid > Bottom avg R |
| 4 | Feature cap | 9 candidates + 1 control (frozen) |
| 5 | Model card complete | v2 template, all sections |
| 6 | Negative controls | 3/3 passed |
| 7 | Entry degradation | ≤25% total R, ≤5pp WR, ≤30% MAR |
| 8 | Slippage stress | Profitable at 2 ticks |
| 9 | Calibration | Quintile scores directionally calibrated OOS |

---

# RISK FRAMEWORK

| Parameter | Value |
|-----------|-------|
| Base risk per trade | 1.5-2.0% (Phase A) |
| SAN cap | $11,000 fixed, reviewed quarterly (next: May 17, 2026) |
| DD brake 1 | 10% → reduce to 1.0% risk |
| DD brake 2 | 15% → reduce to 0.5% risk |
| DD brake 3 | 20% → halt new entries |
| Phase B trigger | Account > $2M for 30 consecutive days |
| Phase B base risk | 1.0% |
| Phase B DD brakes | 5% / 10% / 15% |

---

# DEVELOPMENT PLAN

## Phase 1a: Build (8-10 weeks)

### Weeks 1-2: Data + Simulator
| Task | Description | Est. Time |
|------|-------------|-----------|
| 1 | Export OHLCV for 28 tradable symbols (daily/weekly/monthly/H4) from TradeStation + SBSW from yfinance | 4-5 hrs |
| 1.5 | Data sanitizer (missing bars, bad ticks, roll artifacts) | 1 hr |
| 2 | Build B1 signal detector in Python (per B1 Logic Spec v2) | 2-3 hrs |
| 3 | Build trade simulator + Chart Inspector (Plotly) | 3-4 hrs |
| 4 | Cross-validate Python vs TradeStation on 6-8 symbols | 4-5 hrs |
| 4b | Slippage stress test (0/1/2/3 ticks) | 30 min |

### Weeks 3-4: Features + External Data
| Task | Description | Est. Time |
|------|-------------|-----------|
| 5 | Add MTFA flags (weekly/monthly trend alignment) | 1-2 hrs |
| 6 | Add all confluence flags (WR divergence, clean pullback, etc.) | 2-3 hrs |
| 7 | Integrate COT data (15 futures) + VIX (all symbols) | 2-3 hrs |
| 8 | Database assembly, health check, unit tests, versioning | 2-3 hrs |

### Weeks 5-6: Regression + Analysis
| Task | Description | Est. Time |
|------|-------------|-----------|
| 9 | Pre-register hypotheses, lock reproducibility chain | 45 min |
| 10 | Correlation heatmap → Elastic Net → Model Card | 2-3 hrs |
| 11 | Parameter sensitivity sweep | 2-3 hrs |
| 11b | Negative controls (3 mandatory) | 1 hr |
| 11c | Entry quality degradation test | 30 min |
| 12 | **Chart study sessions (most important task)** | 2-3 hrs |

### Weeks 7-8: Validation + Decision
| Task | Description | Est. Time |
|------|-------------|-----------|
| 13 | OOS validation + calibration (Brier score, reliability plot) | 1-2 hrs |
| 14 | Pass/fail decision (Gate 1) | 1 hr |
| 15 | Archive, drift monitoring setup, report | 2-3 hrs |

**Total estimated: ~35-45 hours of active work over 8-10 weeks**

## Phase 1b: Scoring Upgrade (2-3 weeks)
- Compare single-stage vs two-stage EV scoring on IDENTICAL data
- No universe expansion
- Gate 2 decision

## Phase 2: Breadth + Regime (4-6 weeks)
- Ring 2 expansion (+19 symbols to 48)
- Add FedLiquidityExpanding + Above200DMA features
- Cross-Asset Confirmation Matrix
- Daily Decision Cockpit (Streamlit MVP)
- Morning Intelligence Brief (risk budget + top setups)
- Event De-Risk Protocol

## Phase 3+: Full Infrastructure
- Ring 3-4 expansion
- Strategy expansion (B2, F1, F2, F3)
- Theme-to-Position Mapping with invalidators
- HMM/regime-switching research
- Meta-labeling model
- Advanced dashboard (React if needed)

---

# DASHBOARD ARCHITECTURE

## Phase 1a Dashboard (Streamlit MVP)
1. **Chart Inspector** — per-trade candlestick with EMAs, entry/exit markers, TP/stop levels
2. **MTFA View** — synchronized monthly/weekly/daily panels for any trigger date
3. **Pipeline Health** — ingestion status, row counts, null/duplicate checks
4. **Signal Queue** — ranked active setups with score, expected R, stop distance
5. **Portfolio Risk Summary** — DD tier, SAN usage, total heat, risk budget remaining
6. **Validation Snapshot** — IS/OOS tercile spread, trade counts, MAR/PF quick stats

## Phase 1b Additions
- Model Comparison Panel (single vs two-stage)
- Score Distribution Panel (bucketed expectancy, calibration plot)

## Phase 2 Additions
- Morning Intelligence Brief
- Regime Panel
- Cross-Asset Confirmation Matrix
- Event Risk Panel
- Theme Mapping Panel

## Phase 3+ Additions
- Shadow Portfolio 3-Curve View
- Override & Compliance Analytics
- Historical Analog Finder
- Custom Workspace Builder

**Tech stack:** Streamlit + SQLite + Plotly (Phase 1a-2). React + API layer if needed (Phase 3+).

---

# OPEN ITEMS (Requires Tim Action)

| # | Item | Action Required | Blocking? |
|---|------|----------------|-----------|
| 1 | TradeStation data for ETFs | Confirm XLE, XME, GDX, XLF, XLI, XLK, XLY available in TradeStation subscription | Yes — need data source before Task 1 |
| 2 | TradeStation data for SBSW | Confirm not available → use yfinance (already planned) | No — fallback exists |
| 3 | Fund name | Tim to choose a name for the project/fund | No — cosmetic, can change anytime |
| 4 | ~~Gemini review~~ | **PASSED.** No structural objections. Key additions: formalize research column promotion rule (done), multiple comparisons governance (done). | ~~Yes~~ **Resolved** |
| 5 | B1 Spec v2 finalization | ATR buffer (DP-2) ✓, timeframe lookback (DP-4) ✓, research columns ✓, H4 context ✓, fib nest ✓ — all integrated | **Resolved** |
| 6 | Pre-Build Lock signature | Date-stamp after final review. Ready to sign. | Yes — formal start gate |
| 7 | H4 data availability | Confirm TradeStation provides H4 OHLCV export for futures + equities + ETFs | Yes — need before Task 1 |

---

# QUESTIONS FOR GEMINI

1. **Elastic Net on TheoreticalR as DV** — right regression target? Should we use a different DV, or complement with logistic on win/loss?

2. **9 features + 1 cluster control across 8 clusters, ~900 triggers** — adequately powered? Concerns about features-to-observations ratio per cluster?

3. **COT NULL for 14 of 29 symbols** — handled via cluster fixed effects, no imputation. Statistically sound?

4. **ATR-based breakdown buffer (0.5 ATR, sweep 0.3-0.7)** — better than fixed 2%? Any concerns about using ATR as both a B1 parameter AND as a normalization variable for research columns?

5. **Timeframe-specific swing lookback (daily=20, weekly=12)** — is this introducing a degree of freedom that could be curve-fit, or is it a legitimate structural adjustment?

6. **Calibration (Brier score + reliability plot on quintiles)** — right approach for continuous score → tercile buckets? Alternative calibration methods?

7. **Entry degradation test (30% delayed, tolerances 25%/5pp/30%)** — appropriate tolerances?

8. **Research_only symbols in regression** — should $SBSW participate in coefficient estimation, or be excluded and used only for cross-asset analysis?

9. **The drag-up concept** — is logging `is_drag_up` as a boolean sufficient, or should we model the "EMA catch-up distance" as a continuous variable?

10. **Alternative swing highs** — we're logging absolute, recent, and short-lookback swing highs. Is there a more principled way to identify the "correct" swing high for fib targets (e.g., prominence-based peak detection)?

11. **H4 as context data** — we're acquiring H4 OHLCV and logging H4 200 SMA relationship and trend alignment as research columns (not regression features). Futures H4 anchors to top of hour, equities to market open (9:30 AM). Any concerns about mixing these bar construction conventions within the same regression, given that each instrument's H4 context is self-referential?

12. **Fib retracement nest** — we're logging whether the EMA sits near the 61.8/78.6 retracement of the up-move that created bars-of-air. Proximity tolerance = 0.5 ATR. The swing low is mechanically identified as lowest low in ~12 bars around air sequence start. Is 0.5 ATR a reasonable proximity threshold, or should this be parameterized and swept?

13. **Research column count** — we now have 19 research columns logged alongside 9 regression features. These are explicitly NOT in the Phase 1a regression — they're for chart study and Phase 2 feature candidate evaluation. Any risk that logging this many research variables creates an implicit multiple-comparisons problem when deciding which to promote?

14. **Any methodological blind spots** in the overall approach?

---

*Prepared by: Tim + Claude (research/PM partner)*
*Date: February 17, 2026*
*Status: Ready for Gemini final review*
